{% extends 'base/_dashboard_base.html' %}
{% block title %}Post{% endblock %}
{% block body_title %}Post{% endblock %}
{% load widget_tweaks %}
{% load static %} 
{% block main_content %} 
<div class="box text-center">
    <main class="form-signup">
        <h1 class="h3 mb-3 fw-normal">Update Postagem</h1> 
        <form id="mainform" method="post" class="form" action="" autocomplete="off" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row">  
                <div class="col-sm-6"> 
                    <div class="custom-file mt-3">  
                        {% if object.image %}
                        <div class="post-thumb">
                            <img id="preview" src="{{ object.image.url }}" class="img-thumbnail" alt="logo"/> 
                        </div>
                        {% else %}
                        <div class="post-thumb">
                            <img id="preview" src="{% static 'images/default.png' %}" class="img-thumbnail" alt="default" /> 
                        </div> 
                        {% endif %}   
                        <br>
                        <div class="custom-file">
                            <label class="label-input custom-file-label" for="image">Selecionar thumbnail...</label> 
                            <input type="file" class="custom-file-input" id="image" name="image" aria-describedby="imageadd" autofocus>
                        </div>   
                    </div>   
                    <br>
                    <label for="file">Arquivos até 500M</label> 
                    {% render_field form.download_file class="form-control-input form-control" type="file" id="download_file" name="download_file" accept=".rar, .zip, .jpg, .png, .doc, .docx, .pdf, .txt" %}
                        <p class="text-muted fst-italic" style="font-size:12px;">
                            Formato suportado | Winrar | Zip | JPG | PNG | arquivos unicos.
                            <br><b>Para multiplos arquivos e +500M utilize link externo.</b>
                        </p> 
                    <br>  
                    {% render_field form.download_link class="form-control" type="text" placeholder="Link externo download..." %} 
                </div>  

                <div class="col-sm-6"> 
                    <br>
                    <label>Autor da postagem</label>
                    {% render_field form.author class="form-control" type="text" disabled="disabled" %} 
                    <br>
                    <label>Titulo:</label>
                    {% render_field form.title class="form-control" type="text" %}
                    <br>
                    <label>Descrição</label>
                    {% render_field form.desc class="form-control" type="text" %}
                    <br>    
                    <label>Data de Criação</label>
                    {% render_field form.created_date class="form-control" type="text" disabled="disabled" %} 
                    <br>  
                    <label>Data de Publicação</label>
                    {% render_field form.published_date class="form-control" type="text" %}
                </div>  
            </div>  
            <br> 
            <button type="submit" class="btn-default">Salvar</button>  
            <button class="btn-default"  onclick="location.href='{% url 'post' %}'">Voltar</button>   
        </form>
    </main>
</div>   
<script> 
    $("#image").change(function (event) {
       
      readURL(this);
    });
  
    function readURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        var filename = $("#image").val();
        filename = filename.substring(filename.lastIndexOf('\\') + 1);
        reader.onload = function (e) {
          debugger;
          $('#preview').attr('src', e.target.result);
          $('#preview').hide();
          $('#preview').fadeIn(500);
          $('.custom-file-label').text(filename);
        }
        reader.readAsDataURL(input.files[0]);
      } 
    } 

    // Formulario não envia campos desabilitados
$('#mainform').submit(function(e) {
    $(':disabled').each(function(e) {
        $(this).removeAttr('disabled');
    })
});

  </script>
{% endblock %}
